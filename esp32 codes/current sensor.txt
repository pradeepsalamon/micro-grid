#include "ACS712.h"

ACS712 ACS(34, 3.3, 4095, 66);  // Parameters: analog pin, Vref, ADC resolution, sensor sensitivity
int calibration_factor = 120;

void setup() {
  Serial.begin(115200);
}

void loop() {

  float current = readCurrent();
  delay(200);
}

float readCurrent() {
  float average = 0;

  for (int i = 0; i < 100; i++) {
    average += ACS.mA_AC();
  }

  float mA = (abs(average / 100.0) - calibration_factor);
  if (mA <= 5) mA = 0;  // remove noise

  float amps = mA / 1000.0;  // <-- convert to Ampere
  amps -= 0.14;
  if (amps < 0.10) amps = 0;

  Serial.print("Current: ");
  Serial.print(amps, 3);  // 3 decimal places
  Serial.println(" A");

  return amps;
}
