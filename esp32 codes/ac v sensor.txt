#include <Wire.h>
#include <ZMPT101B.h>

#define SENSITIVITY 500.0f

ZMPT101B criticalVoltageSensor(36, 50.0);
ZMPT101B nonCriticalVoltageSensor(39, 50.0);

// Dual calibration - USE THESE VALUES
#define GRID_CALIBRATION 1.61
#define INVERTER_CALIBRATION 1.85  // Change this until you get 250V

bool usingInverter = false; // Set to false for grid power

void setup() {
  Serial.begin(115200);
  criticalVoltageSensor.setSensitivity(SENSITIVITY);
  nonCriticalVoltageSensor.setSensitivity(SENSITIVITY);
}

void readAcVoltage() {
  float calibration = usingInverter ? INVERTER_CALIBRATION : GRID_CALIBRATION;
  
  float criticalVoltage = criticalVoltageSensor.getRmsVoltage() * calibration;
  float nonCriticalVoltage = nonCriticalVoltageSensor.getRmsVoltage() * calibration;
  
  Serial.print("Critical: ");
  Serial.print(criticalVoltage);
  Serial.print("V | Non-Critical: ");
  Serial.print(nonCriticalVoltage);
  Serial.println("V");
}

void loop() {
  readAcVoltage();
  delay(1000);
}